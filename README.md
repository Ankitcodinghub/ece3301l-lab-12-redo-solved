# ece3301l-lab-12-redo-solved
**TO GET THIS SOLUTION VISIT:** [ECE3301L LAB 12 Redo Solved](https://www.ankitcodinghub.com/product/ece3301l-lab-12-redo-solved/)


---

ðŸ“© **If you need this solution or have special requests:** **Email:** ankitcoding@gmail.com  
ðŸ“± **WhatsApp:** +1 419 877 7882  
ðŸ“„ **Get a quote instantly using this form:** [Ask Homework Questions](https://www.ankitcodinghub.com/services/ask-homework-questions/)

*We deliver fast, professional, and affordable academic help.*

---

<h2>Description</h2>



<div class="kk-star-ratings kksr-auto kksr-align-center kksr-valign-top" data-payload="{&quot;align&quot;:&quot;center&quot;,&quot;id&quot;:&quot;91498&quot;,&quot;slug&quot;:&quot;default&quot;,&quot;valign&quot;:&quot;top&quot;,&quot;ignore&quot;:&quot;&quot;,&quot;reference&quot;:&quot;auto&quot;,&quot;class&quot;:&quot;&quot;,&quot;count&quot;:&quot;0&quot;,&quot;legendonly&quot;:&quot;&quot;,&quot;readonly&quot;:&quot;&quot;,&quot;score&quot;:&quot;0&quot;,&quot;starsonly&quot;:&quot;&quot;,&quot;best&quot;:&quot;5&quot;,&quot;gap&quot;:&quot;4&quot;,&quot;greet&quot;:&quot;Rate this product&quot;,&quot;legend&quot;:&quot;0\/5 - (0 votes)&quot;,&quot;size&quot;:&quot;24&quot;,&quot;title&quot;:&quot;ECE3301L LAB 12 Redo Solved&quot;,&quot;width&quot;:&quot;0&quot;,&quot;_legend&quot;:&quot;{score}\/{best} - ({count} {votes})&quot;,&quot;font_factor&quot;:&quot;1.25&quot;}">

<div class="kksr-stars">

<div class="kksr-stars-inactive">
            <div class="kksr-star" data-star="1" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="2" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="3" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="4" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" data-star="5" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
    </div>

<div class="kksr-stars-active" style="width: 0px;">
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
            <div class="kksr-star" style="padding-right: 4px">


<div class="kksr-icon" style="width: 24px; height: 24px;"></div>
        </div>
    </div>
</div>


<div class="kksr-legend" style="font-size: 19.2px;">
            <span class="kksr-muted">Rate this product</span>
    </div>
    </div>
<div class="page" title="Page 1">
<div class="layoutArea">
<div class="column">
LAB Final: Final Project

We have covered during this semester the following topics:

<ul>
<li>GPIOs</li>
<li>A/D Converter</li>
<li>Temperature sensor</li>
<li>Light sensor</li>
<li>PWM â€“ Fan &amp; speaker</li>
<li>Timer and Counters</li>
<li>System interrupts</li>
<li>TFT interface</li>
<li>I2C bus</li>
<li>SPI bus</li>
<li>RTC</li>
<li>IR Remote Control
The final project will integrate a design that will have the following functions:

<ul>
<li>A TFT panel used as a main display.</li>
<li>An ambient temperature in degree C and F is displayed on the screen</li>
<li>A digital clock shows the time and date</li>
<li>A fan support with full function control â€“ On/Off and speed</li>
<li>An indicator of the duty cycle for the fan control</li>
<li>An alarm function is available to activate a multicolor LED when the alarm set time
is reached
</li>
<li>A remote control used to setup the actual time, the alarm time and the set temperature
for a heater control (represented by the fan).
</li>
<li>A push-button switch used to enable the Alarm function
The hardware schematics is provided on a separate pdf file.
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="page" title="Page 2">
<div class="layoutArea">
<div class="column">
Here is the screenshot of the main screen:

Here are the descriptions of the fields:

<ul>
<li>â€˜25C/77Fâ€™ : Actual Temperature display in degree C and degree F</li>
<li>â€™11:11:31â€™ : Time display</li>
<li>â€˜11/20/21â€™ : Date display</li>
<li>â€˜Alarm Timeâ€™ : Time set for the Alarm</li>
<li>â€˜Alarm Swâ€™ : Switch to turn On or Off the Alarm</li>
<li>â€˜HTR Set Tempâ€™ : Temperature set to control how high the heater should be running
(heater being emulated by the fan â€“ high rpm would represent high output on the

heater)
</li>
<li>ON or OFF depending on the Alarm push-button switch to toggle the function</li>
<li>â€˜HTR Swâ€™ : Switch to turn ON or Off the Heater(Fan) (controlled by the remote
control)
</li>
<li>â€˜DCâ€™: Actual level of Duty Cycle</li>
<li>â€˜RMâ€™ : RTC Match status used for Alarm (active high)</li>
<li>â€˜Voltâ€™: Actual Readout of the voltage of the light sensor</li>
<li>â€˜RPMâ€™: Actual RPM of the fan</li>
</ul>
</div>
</div>
</div>
<div class="page" title="Page 3">
<div class="layoutArea">
<div class="column">
Three setup screens are available to allow changes to the system variables:

<ol>
<li>1) &nbsp;Time Setup Screen:</li>
<li>2) &nbsp;Alarm Setup Screen:</li>
</ol>
</div>
</div>
</div>
<div class="page" title="Page 4">
<div class="layoutArea">
<div class="column">
3) Heater Temp Setup:

A) Setup Operations

Three â€˜Setupâ€™ buttons on the remote control are used to select one of three different setup screens. From the main screen, the following three buttons will force the system to go to different setup screens:

1) â€˜Ch-â€˜ : Time Setup Screen

2) â€˜Châ€™ : Alarm Setup Screen

3) â€˜Ch+â€™: Fan Temperature Setup Screen.

Time Setup Mode:

The screen will show the first line as the time and the second line as the date. The time line has three fields hour:minute:second while the date line shows the fields month/day/year. A cursor is shown on the screen to indicate what field is active. A total of 6 fields can be updated. Two buttons are used to move from one field to another:

</div>
</div>
</div>
<div class="page" title="Page 5">
<div class="layoutArea">
<div class="column">
<ul>
<li>â€˜Prevâ€™ is to move backward. If the cursor is at the first field, then pressing this button will move the cursor to the last field.</li>
<li>â€˜Nextâ€™ will move the cursor forward. If the cursor is at the last field, then it will be move to the first field.
To increase or decrease the content of each field, two buttons are used for this purpose. Button â€˜+â€™ will do the increase while button â€˜-â€˜ will decrease the value.

To exit this Time Setup screen without saving the new data, button â€˜EQâ€™ will facilitate this choice.

To exit and save the new time, the button â€˜Play/Pauseâ€™ is to use for this purpose.

Alarm Setup Mode:

This mode is similar to the Time Setup Mode but it only changes three time fields for the alarm function. It affects the three time registers of the alarm function of the DS3231. The same buttons of the Time Setup Mode are used in this screen.

Heater Set Temperature Mode:

This mode is used to program the temperature level that will trigger the heater to be turned on when the ambient temperature is below that level. The difference between that level temperature and the ambient temperature will be multiplied by 2 and be used as the duty cycle to control the heaterâ€™s (fanâ€™s) speed. Any temperature above that level will force a 0 duty cycle. The set temperature cannot go lower than 50F and cannot go higher than 110F.

Since there is only one field, only the â€˜-â€˜ and â€˜+â€™ buttons are used to increase/decrease the temperature level. The â€˜Prevâ€™ and â€˜Nextâ€™ are illegal buttons while â€˜Play/Pauseâ€™ is still used to save the new data and â€˜EQâ€™ is to exit without saving.

Standard Operations:
</li>
</ul>
1) Heater Operation

When not in any of the Setup mode, the â€˜Play/Pauseâ€™ button is used to switch the fan monitoring operation. .

When the heater is in the â€˜OFFâ€™ mode, the FAN_EN signal must be set to 0 to disable the FET controlling the fan and the duty cycle â€˜DCâ€™ must be set to 0. The FAN_LED is also turned off.

When the heater is toggled to â€˜ONâ€™, the â€˜Heater_Set_Tempâ€™ variable is compared against the ambient temperature. If the ambient temperature is greater than the set

</div>
</div>
</div>
<div class="page" title="Page 6">
<div class="layoutArea">
<div class="column">
temperature, then the fan must be treated as in the â€˜OFFâ€™ condition; both the FAN_EN and the FAN_LED must be turned off.

If lower, take the difference between those two temperatures and multiply it by 2 and use it as the duty cycle. Apply that duty cycle to the fan. Measure the RPM of the fan and show it on the display. FAN_EN and FAN_LED must be turned on to activate the fan. If the difference is greater than 50, make the duty cycle to be 100.

2) Alarm Operation

The Alarm can be enabled or disabled by the Alarm Mode push-button switch. The status of the Alarm operation can be seen under the â€˜Alarm SWâ€™ with the display of either â€˜OFFâ€™ or â€˜ONâ€™. When enabled, the time set under the â€˜Alarm Timeâ€™ will be programmed into the DS3231 chip and the Alarm interrupt operation must be enabled in the DS3231 so that the signal â€˜RTC_ALARM#â€™ will be set to the logic 0 when the alarm time matches with the actual time. When that event happens, the buzzer will be activated and the RGB LED will change to a different color every second from No color, RED, GREEN, YELLOW, BLUE, PURPLE, CYAN and WHITE. The value under â€˜RMâ€™ should show the value of 1 when the time matches. The buzzer and the RGB LED will stay active until the Alarm is turned off or when the light sensor is blocked momentary in order to clear the match. This later event will not disable the Alarm.

Guidance:

1) A base sample of the code is provided to the student to allow shorter development time for the project.

Here is the list of files in the sample code:

o Main.c : this is where the main program resides

o Main_Screen.c : this is the file that will generate the main screen on the LCD o Setup_Time.c : this is where all the functions to support the setup of the time o Setup_Alarm_Time.c : all the functions to support the setup of the alarm time

are handled in this file

o Setup_Heater_Temp.c : the functions to allow the setup of the temperature for

the heater are in this file

o Interrupt.c : this is where the interrupt handler and the code for the IR remote

control function

o I2C.c : this is the original library file for the basic functions to handle the I2C

protocol.

o I2C_Support.c : this is all the functions needed to interface to the DS1621 and

DS3231 ICs

</div>
</div>
</div>
<div class="page" title="Page 7">
<div class="layoutArea">
<div class="column">
o Fan_Support.c : all the functions to support the fan operations should be included in this file

o ST7735_TFT.c : this is the original library file to support the LCD o Utils.c : utility functions are included in this files

<ol start="2">
<li>2) &nbsp;The file â€˜Main.hâ€™ contains all the assignments for the pin signals. Modify them based on the schematics before testing the board.</li>
<li>3) &nbsp;The â€˜Setup_Time.câ€™ is provided as a startup example to modify the time. The routine will start to read the actual time and uses it to setup the startup screen. It will then stay in a while loop to receive incoming buttons from the remote. Based on the inputs, it will call appropriate functions to execute the commands. More detail information will be discussed on the lecture on the implementation.</li>
<li>4) &nbsp;The other two files â€˜Setup_Alarm_Time.câ€™ and â€˜Setup_Heater_Temp.câ€™ are as their names indicate to change the time for the alarm and the set temperature for the heater function.</li>
<li>5) &nbsp;The main routine has the following tasks in its â€˜while (1)â€™ loop:
<ol>
<li>Check for the time change on every second. When that happens, it will:
<ol>
<li>Measure the fanâ€™ s rpm</li>
<li>Measure the ambient temperature</li>
<li>Measure the voltage of the light sensor</li>
<li>Call the function Monitor_Heater() where :
<ol>
<li>The duty cycle is always calculated based on the following conditions:
<ol>
<li>If the set fan temp is lower than the ambient temperature, then the duty cycle is 0.</li>
<li>If it is higher or equal, then the duty cycle is 2 times the difference between the two temperatures</li>
</ol>
</li>
<li>The variable FAN is checked. If 0, then turn off the fan. Else, turn on the fan</li>
</ol>
</li>
<li>Check if the Clock Alarm function by calling the function â€˜Test_Alarm()â€™ (see below)</li>
<li>Output the information on TeraTerm</li>
<li>Update the information on the LCD screen</li>
</ol>
</li>
<li>Check the INT1_flag or INT2_flag (depending where the push-button is connected) is set to detect that the Alarm_Enable/Disable push-button switch is pressed</li>
<li>Check if a button is received. If that happens, it will:</li>
</ol>
</li>
</ol>
i. Check if button is valid. If not, generate a bad beep tone. If yes, then

generate good beep tone and process the button. Here are the allowed buttons:

</div>
</div>
</div>
<div class="page" title="Page 8">
<div class="layoutArea">
<div class="column">
<ol>
<li>â€˜Ch-â€™ for Setup_Time()</li>
<li>â€˜Châ€™ for Setup_Alarm_Time()</li>
<li>â€˜Ch+â€™ for Setup_Fan_T emperature()</li>
<li>â€˜Play/Pauseâ€™ for Toggle_Fan_Monitor()</li>
</ol>
6) The Clock Alarm allows the user to set a desired time for the alarm to sound and to generate a continuous light changing sequence on a RGB LED. When the Alarm switch is activated (by pushing on INT1/INT2 on the main page), the unit will program the RTC chip to compare between the actual time and the alarm time. When the time matches, the signal RTC_ALARM# will be set to 0. The buzzer will be activated and a RGB LED will be changing its color every second. To reset the alarm, either the ALARM SW is toggled or the light to the photo sensor is blocked off.

The routine â€˜Test_Alarm()â€™ in main.c program is the place to implement this function. Follow the basic steps provided in that routine.

<ol>
<li>1) &nbsp;The Alarm mode can be toggled by pushing on the INT1/INT2 push-button. When INT1/INT2 is detected to be 1, it indicates that the push-button has been pressed. This will change the logic state of a variable ALARMEN (initially at logic 0).</li>
<li>2) &nbsp;Need to have a variable called alarm_mode to retain the actual state of the alarm operation.</li>
<li>3) &nbsp;We will have to handle the following situations:
<ol>
<li>alarm_mode is 0 and ALARMEN = 1. This means that no alarm
operation was on and now it is activated. Need to call DS3231_Turn_On_Alarm(); to do the activation and set alarm_mode to 1
</li>
<li>alarm_mode is 1 and ALARMEN = 0. This forces the alarm mode to be disabled. Need to call DS3231_Turn_Off_Alarm(); to turn off the alarm. Next, set alarm_mode to 0, clear out any RGB LED and deactivate the buzzer</li>
<li>alarm_mode is 1 and ALARMEN = 1. This is when the program is waiting for the alarm time to match with the actual time. The signal â€˜RTC_ALARM_NOTâ€™ must be checked to be at logic 0 to indicate that the time matches. When that happens, activate the buzzer and start the RGB LED to show the event. To keep the buzzer going and the RBG LED changing the color for every second, use a variable â€˜MATCHEDâ€™ to show that the matching event did happen. This will continue until the voltage sampled from the light sensor is detected to be above 3.0V because that is when the photo sensor is blocked. At that time, â€˜MATCHEDâ€™ will be cleared and the buzzer will be deactivated as well as the RGB LED will be turned off.</li>
</ol>
</li>
</ol>
</div>
</div>
</div>
